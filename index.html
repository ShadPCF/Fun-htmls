<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Knock Knock Valentine</title>

<style>
:root{
  --bg1:#120818;
  --bg2:#2a0f3b;
  --pink:#ff4d88;
  --rose:#ff2f6d;
  --gold:#ffcc66;
  --mint:#9dffd9;
  --w:rgba(255,255,255,.92);
  --w2:rgba(255,255,255,.72);
  --stroke:rgba(255,255,255,.18);
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--w);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
  overflow:hidden;
  background:
    radial-gradient(900px 600px at 20% 10%, rgba(255,77,136,.28), transparent 60%),
    radial-gradient(800px 520px at 90% 30%, rgba(255,204,102,.18), transparent 62%),
    radial-gradient(900px 700px at 50% 120%, rgba(157,255,217,.10), transparent 60%),
    linear-gradient(160deg, var(--bg1), var(--bg2));
}

.ambient{
  position:fixed;
  inset:-60px;
  pointer-events:none;
  background:
    radial-gradient(28px 28px at 12% 24%, rgba(255,255,255,.20), transparent 60%),
    radial-gradient(22px 22px at 78% 30%, rgba(255,255,255,.14), transparent 60%),
    radial-gradient(26px 26px at 60% 70%, rgba(255,255,255,.12), transparent 60%),
    radial-gradient(18px 18px at 28% 76%, rgba(255,255,255,.10), transparent 60%),
    radial-gradient(24px 24px at 88% 78%, rgba(255,255,255,.12), transparent 60%);
  filter: blur(1px);
  opacity:.55;
  animation: drift 10s ease-in-out infinite alternate;
}

@keyframes drift{
  from{transform:translateY(0) translateX(0) scale(1)}
  to{transform:translateY(-18px) translateX(12px) scale(1.02)}
}

.shell{
  width:92%;
  max-width:460px;
  border-radius:28px;
  padding:18px;
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  box-shadow: 0 26px 90px rgba(0,0,0,.62);
  position:relative;
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:2px 4px 10px 4px;
}

.brand{
  display:flex;
  flex-direction:column;
  gap:2px;
}

.h1{
  margin:0;
  font-weight:950;
  letter-spacing:.2px;
  font-size:18px;
}

.h2{
  margin:0;
  color:var(--w2);
  font-size:12px;
}

.stepPill{
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.18);
  color:rgba(255,255,255,.82);
  font-size:12px;
  font-weight:800;
}

.stage{
  min-height:380px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:16px;
  padding:8px 8px 0 8px;
}

.comic{
  position:relative;
  padding:12px 16px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.20);
  background: rgba(255,255,255,.14);
  font-weight:950;
  letter-spacing:.2px;
  transform: rotate(-2deg);
  animation: pop .32s ease-out both;
  text-align:center;
  max-width:96%;
}

.comic:after{
  content:"";
  position:absolute;
  left:34px;
  bottom:-12px;
  border:12px solid transparent;
  border-top-color: rgba(255,255,255,.14);
  filter: drop-shadow(0 10px 16px rgba(0,0,0,.22));
}

@keyframes pop{
  from{opacity:0;transform:translateY(10px) scale(.97) rotate(-2deg)}
  to{opacity:1;transform:translateY(0) scale(1) rotate(-2deg)}
}

.sceneCard{
  width:min(340px, 92%);
  border-radius:26px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(280px 220px at 60% 10%, rgba(255,77,136,.20), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,.16), rgba(0,0,0,.06));
  box-shadow: 0 18px 60px rgba(0,0,0,.42);
  padding:16px;
}

.doorWrap{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:8px 0 2px 0;
}

.door{
  width:220px;
  height:280px;
  border-radius:22px;
  position:relative;
  border:1px solid rgba(255,255,255,.22);
  background:
    radial-gradient(90px 90px at 80% 45%, rgba(255,255,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.20), rgba(255,255,255,.06));
  box-shadow: 0 20px 55px rgba(0,0,0,.55);
  overflow:hidden;
}

.door:before{
  content:"";
  position:absolute;
  inset:16px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
}

.door:after{
  content:"";
  position:absolute;
  left:14px;
  right:14px;
  top:42%;
  height:1px;
  background: rgba(255,255,255,.12);
}

.knob{
  position:absolute;
  right:18px;
  top:52%;
  width:18px;
  height:18px;
  border-radius:50%;
  background: linear-gradient(180deg, var(--gold), var(--rose));
  box-shadow: 0 10px 18px rgba(0,0,0,.28);
}

.shake{animation: shake .45s ease-in-out}
@keyframes shake{
  0%{transform:none}
  18%{transform:translateX(-6px)}
  36%{transform:translateX(6px)}
  54%{transform:translateX(-4px)}
  72%{transform:translateX(4px)}
  100%{transform:none}
}

.open{
  animation: open2d .7s ease forwards;
}
@keyframes open2d{
  to{transform:translateX(-10px) scaleX(.86); opacity:.94}
}

.spark{
  position:absolute;
  inset:-10px;
  pointer-events:none;
  opacity:0;
}
.spark.on{animation: spark 650ms ease-out both}
@keyframes spark{
  0%{opacity:0;transform:scale(.98)}
  22%{opacity:1}
  100%{opacity:0;transform:scale(1.02)}
}

.metaRow{
  display:flex;
  gap:10px;
  justify-content:center;
  padding-top:10px;
  color:var(--w2);
  font-size:12px;
  font-weight:700;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:14px;
  padding:0 4px;
}

.btn{
  width:100%;
  padding:14px 16px;
  border:none;
  border-radius:18px;
  font-weight:950;
  font-size:15px;
  color:#250517;
  background: linear-gradient(135deg, var(--pink), var(--gold));
  box-shadow: 0 14px 30px rgba(255,77,136,.18);
  -webkit-tap-highlight-color:transparent;
}

.small{
  margin:10px 0 0 0;
  text-align:center;
  color:var(--w2);
  font-size:12px;
}

.bouquetBox{
  width:min(340px, 92%);
  border-radius:26px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(260px 180px at 50% 10%, rgba(255,204,102,.20), transparent 62%),
    linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,.06));
  box-shadow: 0 18px 60px rgba(0,0,0,.42);
  padding:16px;
  animation: fadeUp .55s ease-out both;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(16px) scale(.98)}
  to{opacity:1;transform:translateY(0) scale(1)}
}

.bouquet{
  width:100%;
  height:auto;
  display:block;
}

.float{
  animation: float 1.7s ease-in-out infinite;
}
@keyframes float{
  50%{transform:translateY(-10px)}
}

.cardNote{
  width:min(340px, 92%);
  border-radius:26px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(240px 160px at 60% 10%, rgba(255,77,136,.22), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
  box-shadow: 0 18px 60px rgba(0,0,0,.46);
  padding:16px;
  animation: fadeUp .55s ease-out both;
}

.sealRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding-bottom:10px;
  border-bottom:1px solid rgba(255,255,255,.14);
}

.seal{
  width:34px;height:34px;border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  background: linear-gradient(135deg, rgba(255,77,136,.95), rgba(255,204,102,.85));
  color:#24051b;
  font-weight:950;
  box-shadow: 0 12px 26px rgba(0,0,0,.35);
}

.script{
  font-family: ui-rounded, "Snell Roundhand", "Bradley Hand", "Segoe Script", "Apple Chancery", cursive;
  font-size:30px;
  font-weight:800;
  margin:10px 0 8px 0;
  line-height:1.05;
  text-shadow: 0 14px 30px rgba(0,0,0,.30);
}

.note{
  margin:0;
  color:rgba(255,255,255,.82);
  font-size:14px;
  line-height:1.45;
}

.from{
  margin-top:12px;
  color:rgba(255,255,255,.90);
  font-size:14px;
  font-weight:800;
}

.petals{
  position:fixed;
  inset:0;
  pointer-events:none;
  overflow:hidden;
  display:none;
}
.petals.on{display:block}

.petal{
  position:absolute;
  top:-10%;
  width:14px;
  height:10px;
  border-radius:999px 999px 999px 0;
  filter: drop-shadow(0 10px 12px rgba(0,0,0,.22));
  animation: fall linear forwards;
}

@keyframes fall{
  0%{transform:translateY(-10vh) translateX(0) rotate(0deg); opacity:0}
  12%{opacity:.95}
  100%{transform:translateY(120vh) translateX(36px) rotate(420deg); opacity:0}
}
</style>
</head>

<body>
<div class=ambient></div>
<div class=petals id=petals></div>

<div class=shell>
  <div class=topbar>
    <div class=brand>
      <p class=h1>Knock knock</p>
      <p class=h2>Tap through the tiny story</p>
    </div>
    <div class=stepPill id=stepPill>Step 1</div>
  </div>

  <div class=stage id=stage></div>

  <div class=actions>
    <button class=btn id=btn></button>
  </div>

  <p class=small id=hint>Sound needs one tap on iPhone</p>
</div>

<script>
const stage = document.getElementById("stage")
const btn = document.getElementById("btn")
const stepPill = document.getElementById("stepPill")
const hint = document.getElementById("hint")
const petals = document.getElementById("petals")

let step = 1
let ac = null
let audioReady = false

render()

btn.addEventListener("click", async () => {
  await ensureAudio()
  tapHaptic()

  if (step === 1) {
    knock()
    const d = document.getElementById("door")
    const s = document.getElementById("spark")
    if (d) { d.classList.remove("shake"); void d.offsetWidth; d.classList.add("shake") }
    if (s) { s.classList.remove("on"); void s.offsetWidth; s.classList.add("on") }
    setTimeout(() => { step = 2; render() }, 320)
    return
  }

  if (step === 2) {
    step = 3
    render()
    return
  }

  if (step === 3) {
    step = 4
    render()
    return
  }

  step = 1
  stopPetals()
  render()
})

function render() {
  stepPill.textContent = "Step " + step

  if (step === 1) {
    stage.innerHTML = `
      <div class=comic>Knock knock</div>

      <div class=sceneCard>
        <div class=doorWrap>
          <div class=door id=door>
            <div class=knob></div>
            <svg class=spark id=spark viewBox="0 0 240 300" aria-hidden=true>
              <g fill="none" stroke="rgba(255,255,255,.55)" stroke-width="2">
                <path d="M46 78 L56 70 L62 80 L74 82 L64 90 L66 102 L56 96 L46 102 L48 90 L38 82 Z"/>
                <path d="M172 128 L182 120 L188 130 L200 132 L190 140 L192 152 L182 146 L172 152 L174 140 L164 132 Z"/>
                <path d="M128 54 L138 46 L144 56 L156 58 L146 66 L148 78 L138 72 L128 78 L130 66 L120 58 Z"/>
              </g>
            </svg>
          </div>
        </div>

        <div class=metaRow>
          <div>tap button to answer</div>
          <div>volume up for knock</div>
        </div>
      </div>
    `
    btn.textContent = "Who‚Äôs there"
    hint.textContent = "Sound needs one tap on iPhone"
    return
  }

  if (step === 2) {
    stage.innerHTML = `
      <div class=comic>Who‚Äôs there</div>

      <div class=sceneCard>
        <div class=doorWrap>
          <div class="door open" id=door>
            <div class=knob></div>
          </div>
        </div>

        <div class=metaRow>
          <div>the door opens</div>
          <div>one more</div>
        </div>
      </div>
    `
    btn.textContent = "Valen"
    hint.textContent = "Tap to continue"
    return
  }

  if (step === 3) {
    stage.innerHTML = `
      <div class=comic>Valen</div>

      <div class="bouquetBox float">
        ${bouquetSvg()}
        <div class=metaRow>
          <div>almost there</div>
          <div>final line</div>
        </div>
      </div>
    `
    btn.textContent = "Valen who"
    hint.textContent = "Tap for the reveal"
    return
  }

  stage.innerHTML = `
    <div class=cardNote>
      <div class=sealRow>
        <div style="font-weight:950;letter-spacing:.2px">For you</div>
        <div class=seal>‚ù§</div>
      </div>

      <div class=script>Happy Valentine‚Äôs Day</div>
      <p class=note>
        a bouquet just for you
        hope today feels warm and lucky
      </p>

      <div class=from>üíê from ShadPCF</div>
    </div>
  `
  btn.textContent = "Replay"
  hint.textContent = "petals incoming"
  startPetals()
  celebrate()
}

function bouquetSvg(){
  return `
  <svg class=bouquet viewBox="0 0 420 280" role=img aria-label="bouquet">
    <defs>
      <linearGradient id=g1 x1=0 x2=0 y1=0 y2=1>
        <stop offset=0 stop-color="rgba(255,77,136,.95)"/>
        <stop offset=1 stop-color="rgba(255,204,102,.85)"/>
      </linearGradient>
      <linearGradient id=wrap x1=0 x2=1>
        <stop offset=0 stop-color="rgba(255,255,255,.18)"/>
        <stop offset=1 stop-color="rgba(255,255,255,.06)"/>
      </linearGradient>
    </defs>

    <g transform="translate(210 140)">
      <circle r=92 fill="rgba(255,255,255,.05)"/>

      <g opacity=.98>
        <circle cx=-62 cy=-6 r=30 fill="rgba(255,77,136,.92)"/>
        <circle cx=-28 cy=-54 r=26 fill="rgba(255,204,102,.88)"/>
        <circle cx=10 cy=-64 r=30 fill="rgba(255,77,136,.88)"/>
        <circle cx=48 cy=-40 r=26 fill="rgba(255,204,102,.84)"/>
        <circle cx=66 cy=-2 r=28 fill="rgba(255,77,136,.84)"/>
        <circle cx=26 cy=10 r=32 fill="rgba(255,204,102,.82)"/>
        <circle cx=-20 cy=18 r=32 fill="rgba(255,77,136,.82)"/>
      </g>

      <g stroke="rgba(157,255,217,.70)" stroke-width=6 stroke-linecap=round>
        <path d="M-34 34 C-46 68,-26 96,-10 122"/>
        <path d="M10 32 C 8 68, 30 92, 22 128"/>
        <path d="M44 24 C 62 58, 52 96, 32 132"/>
      </g>

      <g transform="translate(0 128)">
        <path d="M-118 0 L118 0 L76 86 L0 128 L-76 86 Z" fill="url(#wrap)" stroke="rgba(255,255,255,.18)"/>
        <path d="M-76 86 L0 128 L76 86" fill="none" stroke="rgba(255,255,255,.18)"/>
        <circle cx=0 cy=54 r=14 fill="url(#g1)" opacity=.95/>
      </g>
    </g>
  </svg>
  `
}

async function ensureAudio(){
  if (audioReady) return
  try{
    const AudioContext = window.AudioContext || window.webkitAudioContext
    ac = new AudioContext()
    if (ac.state === "suspended") await ac.resume()
    audioReady = true
  }catch(e){
    audioReady = false
  }
}

function knock(){
  if (!audioReady || !ac) return
  const now = ac.currentTime

  const hit = (t) => {
    const o = ac.createOscillator()
    const g = ac.createGain()
    o.type = "triangle"
    o.frequency.setValueAtTime(230, t)
    o.frequency.exponentialRampToValueAtTime(145, t + 0.06)
    g.gain.setValueAtTime(0.0001, t)
    g.gain.exponentialRampToValueAtTime(0.55, t + 0.01)
    g.gain.exponentialRampToValueAtTime(0.0001, t + 0.11)
    o.connect(g)
    g.connect(ac.destination)
    o.start(t)
    o.stop(t + 0.13)
  }

  hit(now + 0.00)
  hit(now + 0.12)
}

function celebrate(){
  if (!audioReady || !ac) return
  const now = ac.currentTime
  const o = ac.createOscillator()
  const g = ac.createGain()
  o.type = "sine"
  o.frequency.setValueAtTime(660, now)
  o.frequency.setValueAtTime(880, now + 0.08)
  o.frequency.setValueAtTime(990, now + 0.16)
  g.gain.setValueAtTime(0.0001, now)
  g.gain.exponentialRampToValueAtTime(0.22, now + 0.02)
  g.gain.exponentialRampToValueAtTime(0.0001, now + 0.30)
  o.connect(g)
  g.connect(ac.destination)
  o.start(now)
  o.stop(now + 0.32)
}

function tapHaptic(){
  try{
    if (navigator.vibrate) navigator.vibrate(12)
  }catch(e){}
}

function startPetals(){
  petals.innerHTML = ""
  petals.classList.add("on")

  const count = 16
  for (let i = 0; i < count; i++){
    const p = document.createElement("div")
    p.className = "petal"
    p.style.left = (Math.random() * 100) + "%"
    p.style.animationDuration = (2.3 + Math.random() * 1.8) + "s"
    p.style.animationDelay = (Math.random() * 0.45) + "s"
    const size = 10 + Math.random() * 10
    p.style.width = size + "px"
    p.style.height = (size * 0.72) + "px"
    p.style.background = Math.random() > 0.5 ? "rgba(255,77,136,.74)" : "rgba(255,204,102,.62)"
    petals.appendChild(p)
  }
}

function stopPetals(){
  petals.classList.remove("on")
  petals.innerHTML = ""
}
</script>
</body>
</html>
