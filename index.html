<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Knock Knock</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --safeT: env(safe-area-inset-top, 0px);
      --safeB: env(safe-area-inset-bottom, 0px);
      --safeL: env(safe-area-inset-left, 0px);
      --safeR: env(safe-area-inset-right, 0px);

      --bg0:#05030a;
      --bg1:#12081e;
      --bg2:#2a0f3f;

      --accent1:#ff3d8e;
      --accent2:#ffd06b;

      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.72);
      --stroke: rgba(255,255,255,.16);

      --cardA: rgba(255,255,255,.12);
      --cardB: rgba(255,255,255,.05);

      --radius: 28px;
      --radius2: 22px;

      --dur1: 160ms;
      --dur2: 260ms;
      --dur3: 420ms;

      --easeOut: cubic-bezier(.16, 1, .3, 1);
      --easeInOut: cubic-bezier(.4, 0, .2, 1);

      --fontUI: "Inter", ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
      --fontTitle: "Playfair Display", ui-serif, Georgia, "Times New Roman", serif;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html, body{ height:100%; }

    body{
      margin:0;
      padding: calc(14px + var(--safeT)) calc(14px + var(--safeR)) calc(16px + var(--safeB)) calc(14px + var(--safeL));
      min-height:100vh;
      min-height:100svh;
      min-height:100dvh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      font-family: var(--fontUI);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(255,61,142,.24), transparent 60%),
        radial-gradient(900px 620px at 90% 20%, rgba(255,208,107,.16), transparent 62%),
        linear-gradient(160deg, var(--bg0), var(--bg1) 40%, var(--bg2));
      transform: translateZ(0);
    }

    .bg-aurora{
      position:fixed;
      inset:-25%;
      z-index:-3;
      opacity:.9;
      filter: blur(26px) saturate(1.12);
      background:
        radial-gradient(620px 420px at 20% 30%, rgba(255,61,142,.35), transparent 60%),
        radial-gradient(560px 420px at 75% 35%, rgba(255,208,107,.22), transparent 62%),
        radial-gradient(520px 460px at 55% 75%, rgba(255,255,255,.06), transparent 62%);
      animation: auroraDrift 16s var(--easeInOut) infinite;
      transform: translate3d(0,0,0);
      will-change: transform;
      pointer-events:none;
    }
    @keyframes auroraDrift{
      0%{ transform: translate3d(-1.5%, -1.2%, 0) scale(1.02) rotate(-1deg); }
      50%{ transform: translate3d(1.4%, 1.1%, 0) scale(1.06) rotate(1deg); }
      100%{ transform: translate3d(-1.5%, -1.2%, 0) scale(1.02) rotate(-1deg); }
    }

    .bg-stars{
      position:fixed;
      inset:0;
      z-index:-2;
      opacity:.65;
      background-image:
        radial-gradient(2px 2px at 12% 22%, rgba(255,255,255,.28) 50%, transparent 52%),
        radial-gradient(1.5px 1.5px at 65% 18%, rgba(255,255,255,.22) 50%, transparent 52%),
        radial-gradient(1.8px 1.8px at 82% 44%, rgba(255,255,255,.18) 50%, transparent 52%),
        radial-gradient(1.2px 1.2px at 22% 76%, rgba(255,255,255,.18) 50%, transparent 52%),
        radial-gradient(1.6px 1.6px at 48% 64%, rgba(255,255,255,.14) 50%, transparent 52%);
      animation: twinkle 7s linear infinite;
      pointer-events:none;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.50; filter: blur(0px); }
      50%{ opacity:.80; filter: blur(.25px); }
    }

    .bg-grain{
      position:fixed;
      inset:-20%;
      z-index:-1;
      pointer-events:none;
      opacity:.10;
      mix-blend-mode: overlay;
      background:
        repeating-radial-gradient(circle at 20% 30%, rgba(255,255,255,.14) 0 1px, transparent 1px 5px),
        repeating-radial-gradient(circle at 70% 60%, rgba(0,0,0,.16) 0 1px, transparent 1px 6px);
      filter: blur(.25px);
      animation: grain 2.6s steps(2) infinite;
      transform: translate3d(0,0,0);
    }
    @keyframes grain{
      0%{ transform: translate3d(-1%, -1%, 0); }
      50%{ transform: translate3d(1%, 1%, 0); }
      100%{ transform: translate3d(-1%, -1%, 0); }
    }

    .wrap{ width: min(560px, 94vw); }

    .card{
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, var(--cardA), var(--cardB));
      box-shadow: 0 26px 110px rgba(0,0,0,.65);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      outline: 1px solid rgba(255,255,255,.04);
    }

    .top{
      padding: 16px 16px 10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .badge{
      width:34px; height:34px;
      border-radius:12px;
      background: linear-gradient(135deg, rgba(255,61,142,.92), rgba(255,208,107,.90));
      box-shadow: 0 12px 28px rgba(255,61,142,.18);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .badge:after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
      transform: rotate(25deg);
      opacity:.55;
      animation: shine 2.2s var(--easeInOut) infinite;
    }
    @keyframes shine{
      0%{ transform: translateX(-35%) rotate(25deg); }
      50%{ transform: translateX(35%) rotate(25deg); }
      100%{ transform: translateX(-35%) rotate(25deg); }
    }

    .title{
      margin:0;
      font-size:16px;
      font-weight:900;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      margin-top:2px;
      font-size:12px;
      font-weight:800;
      color: rgba(255,255,255,.68);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .meta{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }

    .pill{
      font-size:12px;
      font-weight:900;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.24);
      color: rgba(255,255,255,.88);
      white-space:nowrap;
    }

    .stepper{
      display:flex;
      gap:6px;
      padding-right:2px;
      align-items:center;
    }
    .dot{
      width:7px; height:7px;
      border-radius:999px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.14);
      transition: transform var(--dur2) var(--easeOut), background var(--dur2) var(--easeOut);
    }
    .dot.on{
      background: linear-gradient(135deg, rgba(255,61,142,.95), rgba(255,208,107,.92));
      box-shadow: 0 10px 18px rgba(255,61,142,.18);
      transform: scale(1.12);
    }

    .stage{ padding: 12px 14px 12px 14px; }

    .sceneShell{
      border-radius: var(--radius2);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.55);
      box-shadow: 0 18px 70px rgba(0,0,0,.35);
      position:relative;
      height: clamp(360px, 52vh, 460px);
      transform: translate3d(0,0,0);
      z-index: 1;
    }

    .view{
      position:absolute;
      inset:0;
      opacity:0;
      transform: translate3d(0, 10px, 0) scale(.995);
      pointer-events:none;
      transition: opacity var(--dur3) var(--easeOut), transform var(--dur3) var(--easeOut);
      will-change: opacity, transform;
    }
    .view.active{
      opacity:1;
      transform: translate3d(0, 0, 0) scale(1);
      pointer-events:auto;
    }

    .doorArea{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(80% 70% at 50% 30%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(120% 100% at 50% 100%, rgba(0,0,0,.52), transparent 55%),
        radial-gradient(140% 120% at 10% 90%, rgba(255,61,142,.14), transparent 60%),
        radial-gradient(120% 120% at 95% 10%, rgba(255,208,107,.12), transparent 62%);
    }

    .persp{
      width: 92%;
      height: 92%;
      perspective: 1000px;
      position:relative;
      transform: translate3d(0,0,0);
      will-change: transform;
    }

    .doorFrame{
      position:absolute;
      inset:0;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
    }

    .fog{
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(600px 380px at 25% 40%, rgba(255,61,142,.10), transparent 62%),
        radial-gradient(520px 420px at 80% 55%, rgba(255,208,107,.09), transparent 62%);
      filter: blur(18px);
      opacity:.65;
      animation: fog 9s var(--easeInOut) infinite;
      pointer-events:none;
      transform: translate3d(0,0,0);
    }
    @keyframes fog{
      0%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
      50%{ transform: translate3d(2%, 1%, 0) scale(1.06); }
      100%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
    }

    .doorPanel{
      position:absolute;
      inset:0;
      transform-style: preserve-3d;
      transform-origin: 0% 50%;
      transform: rotateY(0deg);
      transition: transform var(--dur3) var(--easeOut), filter var(--dur3) var(--easeOut);
      will-change: transform;
      backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
    }

    .doorImg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(1.03);
      filter: saturate(1.08) contrast(1.05) brightness(1.02);
      user-select:none;
      -webkit-user-drag:none;
    }

    .edgeGlow{
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        linear-gradient(90deg, rgba(255,61,142,.18), transparent 20%),
        radial-gradient(90% 120% at 5% 50%, rgba(255,208,107,.18), transparent 55%);
      mix-blend-mode: screen;
      opacity:.65;
      transform: translate3d(0,0,2px);
    }

    .hint{
      position:absolute;
      left:14px;
      bottom:14px;
      padding:10px 12px;
      border-radius: 14px;
      font-size:12px;
      font-weight:900;
      color: rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 16px 50px rgba(0,0,0,.25);
      pointer-events:none;
      transition: opacity var(--dur2) var(--easeOut);
    }

    .caption{
      position:absolute;
      left:50%;
      top:56%;
      transform: translate3d(-50%,-50%,12px);
      padding: 12px 16px;
      border-radius: 18px;
      font-weight: 1100;
      font-size: 18px;
      letter-spacing: .2px;
      color: rgba(15,10,18,.96);
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 18px 46px rgba(0,0,0,.30);
      user-select:none;
      text-align:center;
      min-width: 140px;
    }
    .caption:after{
      content:"";
      position:absolute;
      left:50%;
      bottom:-9px;
      width: 18px;
      height: 18px;
      background: rgba(255,255,255,.92);
      transform: translateX(-50%) rotate(45deg);
      border-right: 1px solid rgba(0,0,0,.08);
      border-bottom: 1px solid rgba(0,0,0,.08);
      border-bottom-right-radius: 4px;
    }

    /* knock image, plus occasional bottom drift */
    .knockImg{
      position:absolute;
      left:50%;
      top:46%;
      width: min(270px, 68%);
      transform-origin: 50% 55%;
      transform: translate3d(-50%,-50%,6px) rotate(-6deg);
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.48));
      animation: knockWiggle 1.05s var(--easeInOut) infinite;
      pointer-events:none;
      user-select:none;
      -webkit-user-drag:none;
      background: transparent;
      will-change: transform;
      z-index: 6;
    }
    @keyframes knockWiggle{
      0%{ transform: translate3d(-50%,-50%,6px) rotate(-6deg) scale(1); }
      25%{ transform: translate3d(-49%,-51%,6px) rotate(2deg) scale(1.01); }
      50%{ transform: translate3d(-51%,-49%,6px) rotate(-2deg) scale(1); }
      75%{ transform: translate3d(-49.5%,-50%,6px) rotate(3deg) scale(1.01); }
      100%{ transform: translate3d(-50%,-50%,6px) rotate(-6deg) scale(1); }
    }

    .knockBottom{
      animation:
        knockWiggle 1.05s var(--easeInOut) infinite,
        driftBottom 2.8s var(--easeInOut) infinite;
    }
    @keyframes driftBottom{
      0%,100%{ top:46%; }
      50%{ top:72%; }
    }

    .ripple{
      position:absolute;
      left:50%;
      top:52%;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.45);
      transform: translate3d(-50%,-50%,10px) scale(.2);
      opacity: 0;
      pointer-events:none;
      z-index: 7;
    }
    .ripple.go{ animation: ripple var(--dur3) var(--easeOut) forwards; }
    @keyframes ripple{
      0%{ opacity:.85; transform: translate3d(-50%,-50%,10px) scale(.2); }
      100%{ opacity:0; transform: translate3d(-50%,-50%,10px) scale(8); }
    }

    .shake{ animation: shake 460ms var(--easeOut); }
    @keyframes shake{
      0%{ transform: translate3d(0,0,0); }
      20%{ transform: translate3d(-2px, 0, 0); }
      40%{ transform: translate3d(2px, -1px, 0); }
      60%{ transform: translate3d(-1px, 1px, 0); }
      80%{ transform: translate3d(1px, 0, 0); }
      100%{ transform: translate3d(0,0,0); }
    }

    .center{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 24px 18px;
      background:
        radial-gradient(300px 220px at 50% 12%, rgba(255,208,107,.22), transparent 62%),
        radial-gradient(420px 260px at 10% 80%, rgba(255,61,142,.16), transparent 60%),
        radial-gradient(420px 260px at 90% 75%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,.06));
    }

    .panel{
      width: min(420px, 96%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      box-shadow: 0 20px 80px rgba(0,0,0,.35);
      padding: 18px 16px 18px 16px;
      position:relative;
    }

    .emoji{
      font-size: 58px;
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.35));
      animation: pop 900ms var(--easeOut) both;
    }
    @keyframes pop{
      0%{ transform: translate3d(0,16px,0) scale(.85); opacity:0; }
      100%{ transform: translate3d(0,0,0) scale(1); opacity:1; }
    }

    .headline{
      font-family: var(--fontTitle);
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 28px;
      line-height: 1.05;
      margin: 6px 0 0 0;
      background: linear-gradient(135deg, rgba(255,255,255,.95), rgba(255,208,107,.88));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 18px 46px rgba(0,0,0,.18);
    }

    .sub{
      margin-top: 10px;
      font-size: 14px;
      color: rgba(255,255,255,.82);
      line-height: 1.45;
      font-weight: 600;
    }

    .choiceBar{
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index: 8;
    }

    .stack{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 14px;
    }

    .btn{
      width:100%;
      padding: 14px 16px;
      border-radius: 18px;
      border:none;
      cursor:pointer;
      color:#12040c;
      font-size: 15px;
      font-weight: 950;
      letter-spacing:.2px;
      background: linear-gradient(135deg, rgba(255,61,142,.98), rgba(255,208,107,.98));
      box-shadow: 0 16px 38px rgba(255,61,142,.18);
      position:relative;
      overflow:hidden;
      transform: translate3d(0,0,0);
      touch-action: manipulation;
    }
    .btn:before{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
      transform: rotate(25deg);
      opacity:.55;
      animation: btnShine 1.9s var(--easeInOut) infinite;
    }
    @keyframes btnShine{
      0%{ transform: translateX(-35%) rotate(25deg); }
      50%{ transform: translateX(35%) rotate(25deg); }
      100%{ transform: translateX(-35%) rotate(25deg); }
    }
    .btn:active{ transform: translate3d(0,1px,0) scale(.99); }

    .btnGhost{
      width:100%;
      padding: 12px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      font-weight: 950;
      letter-spacing: .2px;
      cursor:pointer;
      touch-action: manipulation;
    }
    .btnGhost:active{ transform: translate3d(0,1px,0) scale(.99); }

    .media{
      margin-top: 12px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.30);
      position:relative;
      aspect-ratio: 1 / 1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .media img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      opacity:0;
      transition: opacity var(--dur3) var(--easeOut);
    }
    .media.loaded img{ opacity:1; }
    .skeleton{
      position:absolute;
      inset:0;
      background:
        linear-gradient(110deg, rgba(255,255,255,.07) 8%, rgba(255,255,255,.14) 18%, rgba(255,255,255,.07) 33%);
      background-size: 200% 100%;
      animation: shimmer 1.1s linear infinite;
      opacity:.9;
    }
    @keyframes shimmer{
      0%{ background-position: 200% 0; }
      100%{ background-position: -200% 0; }
    }
    .media.loaded .skeleton{ display:none; }

    /* bottom bar, must always be tappable on iPhone Safari */
    .bottom{
      padding: 12px 14px 16px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      position: relative;
      z-index: 9999;
    }
    .btnRow{
      display:flex;
      gap:10px;
      position: relative;
      z-index: 10000;
    }
    #backBtn, #nextBtn{
      position: relative;
      z-index: 10001;
      touch-action: manipulation;
    }
    .btnRow .btnGhost{ width:40%; }
    .btnRow .btn{ width:60%; }

    .note{
      text-align:center;
      font-size:12px;
      color: var(--muted);
      line-height: 1.45;
      padding: 0 8px;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      bottom: calc(18px + var(--safeB));
      transform: translate3d(-50%, 20px, 0);
      opacity:0;
      z-index: 20000;
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      transition: opacity var(--dur2) var(--easeOut), transform var(--dur2) var(--easeOut);
      pointer-events:none;
      max-width: 90vw;
      text-align:center;
    }
    .toast.show{
      opacity:1;
      transform: translate3d(-50%, 0, 0);
    }

    /* confetti canvas */
    canvas#confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 15000;
    }

    @media (prefers-reduced-motion: reduce){
      .bg-aurora, .bg-stars, .bg-grain, .fog, .knockImg, .btn:before, .skeleton { animation:none !important; }
      .view, .doorPanel{ transition:none !important; }
    }
  </style>
</head>

<body>
  <div class="bg-aurora"></div>
  <div class="bg-stars"></div>
  <div class="bg-grain"></div>

  <canvas id="confetti" aria-hidden="true"></canvas>
  <div class="toast" id="toast"></div>

  <div class="wrap">
    <div class="card" id="card">
      <div class="top">
        <div class="brand">
          <div class="badge"></div>
          <div style="min-width:0">
            <div class="title">Knock knock</div>
            <div class="subtitle" id="subtitle">tap the door for extra drama</div>
          </div>
        </div>
        <div class="meta">
          <div class="stepper" aria-hidden="true">
            <div class="dot on" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div><div class="dot" id="d4"></div>
            <div class="dot" id="d5"></div><div class="dot" id="d6"></div><div class="dot" id="d7"></div><div class="dot" id="d8"></div>
          </div>
          <div class="pill" id="pill">Step 1</div>
        </div>
      </div>

      <div class="stage">
        <div class="sceneShell" id="shell">

          <!-- Step 1 -->
          <section class="view active" id="v1">
            <div class="doorArea">
              <div class="persp" id="persp1">
                <div class="doorFrame">
                  <div class="fog"></div>
                  <div class="doorPanel" id="doorPanel1">
                    <img class="doorImg" src="door.jpeg" alt="door">
                    <div class="edgeGlow"></div>
                  </div>
                </div>
                <img class="knockImg" id="knockImg" src="IMG_0143.png" alt="knock knock">
                <div class="ripple" id="ripple1"></div>
                <div class="hint" id="hint1">tap the door</div>
              </div>
            </div>
          </section>

          <!-- Step 2 -->
          <section class="view" id="v2">
            <div class="doorArea">
              <div class="persp" id="persp2">
                <div class="doorFrame">
                  <div class="fog"></div>
                  <div class="doorPanel" id="doorPanel2">
                    <img class="doorImg" src="door.jpeg" alt="door">
                    <div class="edgeGlow"></div>
                  </div>
                </div>

                <div class="caption" id="valenCap">Valen</div>
                <div class="ripple" id="ripple2"></div>
                <div class="hint" id="hint2">pick Valen who</div>

                <div class="choiceBar">
                  <button class="btnGhost" id="wrong1">Valen what</button>
                  <button class="btnGhost" id="wrong2">Valen where</button>
                  <button class="btn" id="rightValen">Valen who</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 3 -->
          <section class="view" id="v3">
            <div class="center" id="vdayTap">
              <div class="panel">
                <div class="emoji">üíê</div>
                <div class="headline">Happy Valentine‚Äôs Day</div>
                <div class="sub">sending you love and good vibes<br>tap for confetti</div>
              </div>
            </div>
          </section>

          <!-- Step 4 -->
          <section class="view" id="v4">
            <div class="center">
              <div class="panel">
                <div class="headline" style="font-size:26px">Click to Test your love</div>
                <div class="sub">pick one</div>
                <div class="stack">
                  <button class="btnGhost" id="love1">I love shad</button>
                  <button class="btnGhost" id="love2">I love shad heaps</button>
                  <button class="btn" id="love3">I love shad the most</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 5 -->
          <section class="view" id="v5">
            <div class="center" id="resultTap">
              <div class="panel">
                <div class="headline" id="resultTitle" style="font-size:26px">internet hug!</div>
                <div class="sub">tap for confetti<br>you can add your own image later</div>
                <div class="media" id="resultMedia">
                  <div class="skeleton"></div>
                  <img id="resultImg" alt="result gif" loading="lazy" decoding="async">
                </div>
              </div>
            </div>
          </section>

          <!-- Step 6 -->
          <section class="view" id="v6">
            <div class="center">
              <div class="panel">
                <div class="headline" style="font-size:26px">LUCKY!</div>
                <div class="sub">tap the red packet</div>
                <button class="btnGhost" id="packetBtn" style="margin-top:12px">üßß Open red packet</button>
                <div class="media" id="packetMedia" style="margin-top:12px">
                  <div class="skeleton"></div>
                  <img id="packetImg" alt="red packet gif" loading="lazy" decoding="async">
                </div>
              </div>
            </div>
          </section>

          <!-- Step 7 -->
          <section class="view" id="v7">
            <div class="center" id="letterTap">
              <div class="panel">
                <div class="emoji" style="font-size:42px">üíå</div>
                <div class="headline" style="font-size:22px; margin-top:10px">I love you</div>
                <div class="sub" style="text-align:left">
                  I love you so much, kindest soul to ever to come in my life. I miss you have a blast and come back to my arms quick<br><br>
                  Love Yours,<br>
                  Shad<br><br>
                  <b>P.S Happy Early Chinese new Year. Click the button</b>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 8 -->
          <section class="view" id="v8">
            <div class="center" id="finalTap">
              <div class="panel">
                <div class="emoji">üßß</div>
                <div class="headline" style="font-size:26px">Check your account for red packets!</div>
                <div class="sub">happy early chinese new year<br>tap for confetti</div>
              </div>
            </div>
          </section>

        </div>
      </div>

      <div class="bottom">
        <div class="btnRow">
          <button class="btnGhost" id="backBtn" style="display:none">Back</button>
          <button class="btn" id="nextBtn">Who‚Äôs there</button>
        </div>
        <div class="note" id="note">tap the button</div>
      </div>
    </div>
  </div>

  <script>
    // local assets you provide in repo
    const DOOR_SRC = "door.jpeg"
    const KNOCK_SRC = "IMG_0143.png"

    // direct tenor GIF endpoints (works better than embed.js)
    const GIF_HUG = "https://media1.tenor.com/m/zIacwDB2Mr0AAAAd/huhhh.gif"
    const GIF_KISS = "https://media1.tenor.com/m/5H7rmBUfr5AAAAAd/love-you.gif"
    const GIF_PACKET = "https://media1.tenor.com/m/T_DRG_1RTIUAAAAd/cny2020-chinese-new-year.gif"

    // elements
    const card = document.getElementById("card")
    const toast = document.getElementById("toast")

    const subtitle = document.getElementById("subtitle")
    const pill = document.getElementById("pill")
    const note = document.getElementById("note")

    const backBtn = document.getElementById("backBtn")
    const nextBtn = document.getElementById("nextBtn")

    const dots = [
      document.getElementById("d1"), document.getElementById("d2"), document.getElementById("d3"), document.getElementById("d4"),
      document.getElementById("d5"), document.getElementById("d6"), document.getElementById("d7"), document.getElementById("d8")
    ]

    const views = []
    for (let i = 1; i <= 8; i++) views.push(document.getElementById("v" + i))

    const persp1 = document.getElementById("persp1")
    const doorPanel1 = document.getElementById("doorPanel1")
    const ripple1 = document.getElementById("ripple1")
    const hint1 = document.getElementById("hint1")
    const knockImg = document.getElementById("knockImg")

    const persp2 = document.getElementById("persp2")
    const doorPanel2 = document.getElementById("doorPanel2")
    const ripple2 = document.getElementById("ripple2")
    const hint2 = document.getElementById("hint2")

    const wrong1 = document.getElementById("wrong1")
    const wrong2 = document.getElementById("wrong2")
    const rightValen = document.getElementById("rightValen")

    const vdayTap = document.getElementById("vdayTap")
    const resultTap = document.getElementById("resultTap")
    const letterTap = document.getElementById("letterTap")
    const finalTap = document.getElementById("finalTap")

    const love1 = document.getElementById("love1")
    const love2 = document.getElementById("love2")
    const love3 = document.getElementById("love3")

    const resultTitle = document.getElementById("resultTitle")
    const resultMedia = document.getElementById("resultMedia")
    const resultImg = document.getElementById("resultImg")

    const packetBtn = document.getElementById("packetBtn")
    const packetMedia = document.getElementById("packetMedia")
    const packetImg = document.getElementById("packetImg")

    // state
    let step = 1
    let historyStack = [1]
    let lastLove = "hug"
    let autoKnockTimer = null

    // audio (optional, tiny synth)
    let audioReady = false
    let ctx = null

    // confetti
    const confetti = setupConfetti()

    // init
    preload([DOOR_SRC, KNOCK_SRC, GIF_HUG, GIF_KISS, GIF_PACKET])
    stabilizeKnock(knockImg)
    makeWhiteTransparent(knockImg)
    setupDoor(persp1, doorPanel1, ripple1, hint1)
    setupDoor(persp2, doorPanel2, ripple2, hint2)

    // important for iOS Safari
    bindTap(nextBtn, () => onNext())
    bindTap(backBtn, () => onBack())

    bindTap(wrong1, () => wrongValen())
    bindTap(wrong2, () => wrongValen())
    bindTap(rightValen, () => { sparkleSound(); confetti.burst(110); popToast("nice"); setStep(3) })

    bindTap(love1, () => { lastLove = "hug"; setStep(5) })
    bindTap(love2, () => { lastLove = "kisses"; setStep(5) })
    bindTap(love3, () => setStep(6))

    bindTap(packetBtn, () => setStep(7))

    // tap for confetti
    vdayTap.addEventListener("click", () => { sparkleSound(); confetti.burst(140) }, { passive:true })
    resultTap.addEventListener("click", () => { sparkleSound(); confetti.burst(90) }, { passive:true })
    letterTap.addEventListener("click", () => { sparkleSound(); confetti.burst(70) }, { passive:true })
    finalTap.addEventListener("click", () => { sparkleSound(); confetti.burst(160) }, { passive:true })

    // prime audio on first interaction
    window.addEventListener("pointerdown", () => ensureAudio(), { passive:true, once:true })

    // occasionally drift knock image down to bottom
    setInterval(() => {
      if (step !== 1) return
      if (Math.random() < 0.45) knockImg.classList.toggle("knockBottom", true)
      setTimeout(() => knockImg.classList.toggle("knockBottom", false), 2200)
    }, 2600)

    setStep(1, false)

    function onNext(){
      if (step === 1) return setStep(2)
      if (step === 3) return setStep(4)
      if (step === 5) return setStep(4)
      if (step === 7) return setStep(8)
      if (step === 8) return setStep(1)
    }

    function onBack(){
      if (historyStack.length <= 1) return
      historyStack.pop()
      setStep(historyStack[historyStack.length - 1], false)
    }

    function pushHistory(s){
      if (historyStack[historyStack.length - 1] !== s) historyStack.push(s)
    }

    function setStep(s, push=true){
      step = s
      if (push) pushHistory(s)

      // update header
      pill.textContent = "Step " + step
      dots.forEach((d, i) => d && d.classList.toggle("on", i === (step - 1)))

      // show view
      views.forEach(v => v && v.classList.remove("active"))
      const v = document.getElementById("v" + step)
      if (v) v.classList.add("active")

      // back visibility
      const canBack = historyStack.length > 1
      backBtn.style.display = canBack ? "" : "none"

      // stop any auto knock
      clearAutoKnock()

      // per-step UI
      if (step === 1){
        subtitle.textContent = "tap the door for extra drama"
        nextBtn.style.display = ""
        nextBtn.textContent = "Who‚Äôs there"
        note.textContent = "tap the button"
        backBtn.style.display = "none"
        startAutoKnock()
        return
      }

      if (step === 2){
        subtitle.textContent = "pick Valen who"
        nextBtn.style.display = "none"
        note.textContent = "choose the correct option"
        hint2.style.opacity = "1"
        return
      }

      if (step === 3){
        subtitle.textContent = "happy valentine‚Äôs day"
        nextBtn.style.display = ""
        nextBtn.textContent = "Click to Test your love"
        note.textContent = "tap the card for confetti"
        sparkleSound()
        confetti.burst(160)
        return
      }

      if (step === 4){
        subtitle.textContent = "test your love"
        nextBtn.style.display = "none"
        note.textContent = "pick one of the three buttons"
        return
      }

      if (step === 5){
        subtitle.textContent = "result"
        nextBtn.style.display = ""
        nextBtn.textContent = "Back to test"
        note.textContent = "tap the card for confetti"
        const isHug = lastLove === "hug"
        resultTitle.textContent = isHug ? "internet hug!" : "Virtual Kisses"
        loadMedia(resultMedia, resultImg, isHug ? GIF_HUG : GIF_KISS)
        return
      }

      if (step === 6){
        subtitle.textContent = "lucky path"
        nextBtn.style.display = "none"
        note.textContent = "tap the red packet button"
        loadMedia(packetMedia, packetImg, GIF_PACKET)
        sparkleSound()
        confetti.burst(90)
        return
      }

      if (step === 7){
        subtitle.textContent = "message"
        nextBtn.style.display = ""
        nextBtn.textContent = "Click the button"
        note.textContent = "one more step"
        sparkleSound()
        confetti.burst(80)
        return
      }

      subtitle.textContent = "final"
      nextBtn.style.display = ""
      nextBtn.textContent = "Replay"
      note.textContent = "tap the card for confetti"
      sparkleSound()
      confetti.burst(170)
    }

    function wrongValen(){
      bump(card)
      knockSound()
      confetti.burst(40)
      popToast("try again")
    }

    function bindTap(el, fn){
      if (!el) return
      const handler = (e) => {
        e.preventDefault()
        e.stopPropagation()
        fn()
      }
      el.addEventListener("pointerup", handler, { passive:false })
      el.addEventListener("touchend", handler, { passive:false })
      el.addEventListener("click", handler, { passive:false })
    }

    function popToast(text){
      toast.textContent = text
      toast.classList.add("show")
      clearTimeout(toast.__t)
      toast.__t = setTimeout(() => toast.classList.remove("show"), 1100)
    }

    function bump(el){
      if (!el) return
      el.classList.remove("shake")
      void el.offsetWidth
      el.classList.add("shake")
    }

    function setupDoor(persp, panel, ripple, hint){
      if (!persp) return

      const doKnock = () => {
        if (hint) hint.style.opacity = "0"
        bump(card)
        knockSound()

        if (ripple){
          ripple.classList.remove("go")
          void ripple.offsetWidth
          ripple.classList.add("go")
        }
        if (panel){
          panel.classList.remove("shake")
          void panel.offsetWidth
          panel.classList.add("shake")
        }
      }

      persp.addEventListener("click", () => doKnock(), { passive:true })

      // tiny parallax tilt
      let raf = 0
      const rect = () => persp.getBoundingClientRect()
      const onMove = (x, y) => {
        const r = rect()
        const nx = (x - (r.left + r.width/2)) / (r.width/2)
        const ny = (y - (r.top + r.height/2)) / (r.height/2)
        if (!raf){
          raf = requestAnimationFrame(() => {
            raf = 0
            const rotY = clamp(nx, -1, 1) * 3
            const rotX = -clamp(ny, -1, 1) * 2
            persp.style.transform = `translate3d(0,0,0) rotateX(${rotX}deg) rotateY(${rotY}deg)`
          })
        }
      }

      persp.addEventListener("mousemove", (e) => onMove(e.clientX, e.clientY), { passive:true })
      persp.addEventListener("touchmove", (e) => {
        const t = e.touches && e.touches[0]
        if (!t) return
        onMove(t.clientX, t.clientY)
      }, { passive:true })

      const reset = () => { persp.style.transform = "translate3d(0,0,0)" }
      persp.addEventListener("mouseleave", reset, { passive:true })
      persp.addEventListener("touchend", reset, { passive:true })
    }

    function startAutoKnock(){
      autoKnockTimer = setInterval(() => {
        if (step !== 1) return
        bump(card)
        knockSound()
        ripple1.classList.remove("go")
        void ripple1.offsetWidth
        ripple1.classList.add("go")
        doorPanel1.classList.remove("shake")
        void doorPanel1.offsetWidth
        doorPanel1.classList.add("shake")
      }, 2200)
    }

    function clearAutoKnock(){
      if (autoKnockTimer){
        clearInterval(autoKnockTimer)
        autoKnockTimer = null
      }
    }

    function stabilizeKnock(imgEl){
      if (!imgEl) return
      const lock = () => {
        imgEl.style.left = "50%"
        imgEl.style.top = "46%"
      }
      lock()
      window.addEventListener("resize", lock, { passive:true })
      window.addEventListener("orientationchange", lock, { passive:true })
      document.addEventListener("visibilitychange", lock, { passive:true })
      setTimeout(lock, 200)
      setTimeout(lock, 700)
    }

    function preload(urls){
      urls.forEach(src => { const img = new Image(); img.src = src })
    }

    // best effort: converts white background to transparency for your knock image
    function makeWhiteTransparent(imgEl){
      if (!imgEl || imgEl.dataset.transparentDone) return
      imgEl.dataset.transparentDone = "1"

      const run = () => {
        try{
          const w = imgEl.naturalWidth
          const h = imgEl.naturalHeight
          if (!w || !h) return
          const c = document.createElement("canvas")
          c.width = w
          c.height = h
          const g = c.getContext("2d", { willReadFrequently:true })
          g.drawImage(imgEl, 0, 0)
          const img = g.getImageData(0, 0, w, h)
          const d = img.data
          for (let i = 0; i < d.length; i += 4){
            const r = d[i], gg = d[i+1], b = d[i+2], a = d[i+3]
            if (a === 0) continue
            const lum = 0.2126*r + 0.7152*gg + 0.0722*b
            const newA = Math.max(0, Math.min(255, Math.round((255 - lum) * 3.0)))
            d[i+3] = newA
          }
          g.putImageData(img, 0, 0)
          imgEl.src = c.toDataURL("image/png")
        }catch(e){}
      }

      if (imgEl.complete) run()
      else imgEl.addEventListener("load", run, { once:true })
    }

    function loadMedia(mediaEl, imgEl, src){
      if (!mediaEl || !imgEl) return
      mediaEl.classList.remove("loaded")
      imgEl.style.opacity = "0"
      imgEl.removeAttribute("src")

      imgEl.onload = () => { mediaEl.classList.add("loaded") }
      imgEl.onerror = () => {
        mediaEl.innerHTML = `<div style="padding:14px;text-align:center;font-weight:900;color:rgba(255,255,255,.86)">
          gif failed to load<br><a style="color:rgba(255,255,255,.92)" href="${src}" target="_blank" rel="noopener">open gif</a>
        </div>`
      }
      imgEl.src = src
    }

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)) }

    function ensureAudio(){
      if (audioReady) return
      try{ ctx = new (window.AudioContext || window.webkitAudioContext)(); audioReady = true }
      catch(e){ audioReady = false }
    }

    function knockSound(){
      ensureAudio()
      if (!audioReady || !ctx) return
      if (ctx.state === "suspended") ctx.resume().catch(() => {})
      const now = ctx.currentTime
      const hit = (t, freq, dur, gain) => {
        const o = ctx.createOscillator()
        const g = ctx.createGain()
        const f = ctx.createBiquadFilter()
        o.type = "triangle"
        o.frequency.setValueAtTime(freq, t)
        f.type = "lowpass"
        f.frequency.setValueAtTime(980, t)
        f.Q.setValueAtTime(0.8, t)
        g.gain.setValueAtTime(0.0001, t)
        g.gain.exponentialRampToValueAtTime(gain, t + 0.01)
        g.gain.exponentialRampToValueAtTime(0.0001, t + dur)
        o.connect(f); f.connect(g); g.connect(ctx.destination)
        o.start(t); o.stop(t + dur + 0.03)
      }
      hit(now + 0.00, 210, 0.09, 0.09)
      hit(now + 0.07, 180, 0.11, 0.07)
    }

    function sparkleSound(){
      ensureAudio()
      if (!audioReady || !ctx) return
      if (ctx.state === "suspended") ctx.resume().catch(() => {})
      const now = ctx.currentTime
      const o = ctx.createOscillator()
      const g = ctx.createGain()
      const f = ctx.createBiquadFilter()
      o.type = "sine"
      o.frequency.setValueAtTime(740, now)
      o.frequency.exponentialRampToValueAtTime(1180, now + 0.08)
      f.type = "highpass"
      f.frequency.setValueAtTime(480, now)
      g.gain.setValueAtTime(0.0001, now)
      g.gain.exponentialRampToValueAtTime(0.06, now + 0.01)
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.12)
      o.connect(f); f.connect(g); g.connect(ctx.destination)
      o.start(now); o.stop(now + 0.14)
    }

    // simple confetti
    function setupConfetti(){
      const canvas = document.getElementById("confetti")
      const c = canvas.getContext("2d")
      let W = 0, H = 0
      let pieces = []
      let running = false

      const resize = () => {
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1))
        W = Math.floor(window.innerWidth)
        H = Math.floor(window.innerHeight)
        canvas.width = Math.floor(W * dpr)
        canvas.height = Math.floor(H * dpr)
        canvas.style.width = W + "px"
        canvas.style.height = H + "px"
        c.setTransform(dpr, 0, 0, dpr, 0, 0)
      }

      const add = (n) => {
        const cx = W * 0.5
        const cy = H * 0.34
        for (let i = 0; i < n; i++){
          const t = Math.random() * Math.PI * 2
          const sp = 2 + Math.random() * 6
          pieces.push({
            x: cx + (Math.random() * 18 - 9),
            y: cy + (Math.random() * 18 - 9),
            vx: Math.cos(t) * sp,
            vy: Math.sin(t) * sp - 1.6,
            g: 0.12 + Math.random() * 0.10,
            r: 2 + Math.random() * 4,
            a: 1,
            rot: Math.random() * Math.PI * 2,
            vr: (Math.random() - 0.5) * 0.35,
            heart: Math.random() < 0.55
          })
        }
      }

      const drawHeart = (x, y, s, rot, alpha) => {
        c.save()
        c.translate(x, y)
        c.rotate(rot)
        c.scale(s, s)
        c.globalAlpha = alpha
        c.beginPath()
        c.moveTo(0, 0.35)
        c.bezierCurveTo(-0.5, -0.15, -0.55, -0.55, 0, -0.25)
        c.bezierCurveTo(0.55, -0.55, 0.5, -0.15, 0, 0.35)
        c.closePath()
        c.fill()
        c.restore()
        c.globalAlpha = 1
      }

      const tick = () => {
        if (!running) return
        c.clearRect(0, 0, W, H)

        for (let i = pieces.length - 1; i >= 0; i--){
          const p = pieces[i]
          p.vy += p.g
          p.x += p.vx
          p.y += p.vy
          p.rot += p.vr
          p.a *= 0.988

          if (p.y > H + 40 || p.a < 0.03){
            pieces.splice(i, 1)
            continue
          }

          const grad = c.createLinearGradient(p.x - 10, p.y - 10, p.x + 10, p.y + 10)
          grad.addColorStop(0, "rgba(255,255,255," + (0.18 * p.a) + ")")
          grad.addColorStop(0.2, "rgba(255,61,142," + (0.72 * p.a) + ")")
          grad.addColorStop(1, "rgba(255,208,107," + (0.72 * p.a) + ")")
          c.fillStyle = grad

          if (p.heart) drawHeart(p.x, p.y, p.r, p.rot, p.a)
          else{
            c.globalAlpha = p.a
            c.beginPath()
            c.arc(p.x, p.y, p.r, 0, Math.PI * 2)
            c.fill()
            c.globalAlpha = 1
          }
        }

        if (pieces.length === 0){
          running = false
          return
        }
        requestAnimationFrame(tick)
      }

      window.addEventListener("resize", resize, { passive:true })
      resize()

      return {
        burst(n){
          add(n || 120)
          if (!running){
            running = true
            requestAnimationFrame(tick)
          }
        }
      }
    }
  </script>
</body>
</html>
